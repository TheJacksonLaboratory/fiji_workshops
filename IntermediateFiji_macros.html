<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Intermediate Fiji: Macros and Scripting</title>
<link rel="stylesheet" href="dist/reveal.css">
<link rel="stylesheet" href="dist/theme/cci.css">
<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
<!-- Theme used for syntax highlighting of code -->
<link rel="stylesheet" href="plugin/highlight/vs.css">
</head>
<body>
<div class="reveal">
<!-- Header logo -->
<!--img style="position:fixed;top:1em;right:1em;" src="img/logo_cci.png" width="15%"-->
<!-- Slide Title -->
<header style="position: absolute;top: 1em; left: 1em; z-index:10;"></header>


<!-- ---------------------- START OF SLIDES -------------------------- -->


<div class="slides">

<section data-menu-title="Title">
<h2>Intermediate Fiji: Macros and Scripting</h2>
<h4>Peter Sobolewski (he/him)<br>Systems Analyst, Imaging Applications - Research IT</h4>
<p class="subtle">Use <i class="fa fa-arrow-right"></i> to advance the slide</p>
</section>


<section data-state="intro0">
        <h2>
            <b>Acknowledgements</b>
        </h2>
        
   
    <ul>
        <li>Erick Ratamero (JAX), who prepared the original of <i>these</i> materials</li>
        <li><a href="https//github.com/phivk">Philo van Kemenade</a> for the <a href="https://slides.com/phivk/intro2python">set of slides</a> Erick used for the structure and some images</li>
    
    </section>

    <section data-state="intro0">
        <h2>
            <b>This Workshop</b>
        </h2>
        
   
    <ul>
        <li>Programming building blocks</li>
        <li>Putting the pieces together</li>
        <li>Writing complete structures</li></ul>
    
    </section>

    <section data-state="intro0">
        <h2>These Slides</h2>
        
            <br/>
        
            <br/>
        
            <br/>
        
            <a href="https://thejacksonlaboratory.github.io/fiji_workshops/IntermediateFiji_macros.html" target="_blank">https://thejacksonlaboratory.github.io/fiji_workshops/IntermediateFiji_macros.html</a>
            <br/>
       
    </section>
    

    <section data-state="intro0">
        <h2>Getting help</h2>
       
        <ul>
            <li>Macro Function Documentation at <a href="https://imagej.net/ij/developer/macro/functions.html" target="_blank">https://imagej.nih.gov/ij/developer/macro/functions.html</a></li>
            <li><code>[Plugins > Macro > Record...]</code> is your best friend</li>
            <li><a target="_blank" href="https://bridges.monash.edu/articles/educational_resource/Fiji_Training_Manual_v6_5_/21901989">Fiji Training Notes by Cameron Newell, Monash University</a></li>
            <li><a href="https://forum.image.sc">image.sc forum</a></li>
        </ul>    
    
                
    </section>

    <section data-state="intro0">
        <h2>Why macros?</h2>
       
         <ul>
             <li>Automation: do the same thing many times over</li>
             <li>Reproducibility: do exactly the same thing every time, show the world what you've done</li>
             <li>Sharing: let someone else do exactly the same analysis as you</li>
             <li>Extension: do things Fiji cannot do by default</li>
         </ul>  
       
                
    </section>

    <!-- ---------------------- APPLICATIONS BATCH PROCESSING -------------------------- -->



    <section id="Batch" data-menu-title="Batch Processing" data-state="apps20z"><style>.apps20z header:after { content: ""; }</style>
	<h1>Batch Processing</h1>
	<h4>Why batch process? File conversion, batch processing, scripting</h4>
	</section>
	
	
	<section data-state="apps20"><style>.apps20 header:after { content: "Batch Processing: Theory"; }</style>
	<p>Manual analysis (while sometimes necessary) can be laborious, error prone and not provide the provenance required. Batch processing allows the same processing to be run on multiple images.</p>
	
	<p>The built-in <code>[Process > Batch]</code> menu has lots of useful functions:</p>
	<img class="half" src="img-ia/batch_01.png"/>
	</section> 

	<section data-menu-title="Macro Recorder" data-state="apps22"><style>.apps22 header:after { content: "Batch Processing: Macro Recorder"; }</style>
		The Macro Recorder <code>[Plugins > Macros > Record...]</code>can enable you to generate simple macros without having to write them yourself.
		<ul>
			<li>With the Recorder open, (almost) every action you take in Fiji will be recorded as a macro command--this includes many Plugin functions!</li>
		<li>The recorded Macros can be saved ("Create" button and Save) and then re-run <code>[Plugins > Macros > Run...]</code></li>
		</ul>
		<img src="img-ia/macro_recorder.png"/>
		</section>
	
	<!--BEGINNING of TASK 8 -->
	
	<section data-state="apps22"><style>.apps22 header:after { content: "Batch Processing: Macro Recorder"; }</style>
		<h2>Exercise: Macro Recorder</h2>
		<ul><li>Ensure you have the the zip file <a href="material/BBBC008_partial.zip"><code>BBBC008_partial.zip</code></a> extracted to a known location and a that you have a second folder called "Output" next to it.
		<li>Open <code><a href="material/Task1_MacroRec.pdf">Task1_MacroRec.pdf</a></code> and follow the instructions there.</li></ul>
		</section> 
		
		<!--END of TASK 8 -->

        <section data-menu-title="Fiji Script Editor" data-state="apps23"><style>.apps23 header:after { content: "Fiji Script Editor"; }</style>
            <p>The Script Editor <code>[File > New > Script...]</code> (or keyboard shortcut <code>[</code>) can can be used to edit, write, and run macros & scripts.</p>
            <img src="img-ia/script_editor.png"/>
            </section>

        <section data-state="apps23"><style>.apps23 header:after { content: "Fiji Script Editor"; }</style>
            <p>The Script Editor has a number of nice features:
                <ul>
                    <li>Support for multiple scripting languages, including ImageJ macro</li>
                    <li>Code hints and completions</li>
                    <li><code>Run</code> button to easily test macros</li>
                    <li>Templates to help get you started</li>
                    <li>Help menu with resources</li>
                </ul>
                <p>Handy shortcuts:</p>
                <ul>
                    <li>Command/Control-R: Run the whole macro</li>
                    <li>Shift-Command/Control-R: Run selected lines</li>
                </ul>
            </section>

        <section data-menu-title="ImageJ Macro Language" data-state="apps24"><style>.apps24 header:after { content: "ImageJ Macro Language"; }</style>
            <p>We will be using the ImageJ Macro language. It's the native programming language to ImageJ and is used by the Macro Recorder, making it an ideal starting point.</p>
                <ul>
                    <li><a href="https://imagej.net/ij/developer/macro/macros.html">ImageJ Macro Language documentation</a></li>
                </ul>
                <img src="img-ia/macro_recorder_create.png"/>
            <p>Note: If you want to explore other languages on your own, the <a href="https://imagej.net/scripting/">ImageJ Scripting Guide</a> can be a good place to start.</p>
            </section>  


    <section data-menu-title="Building Blocks" data-state="bb">
        
        
        <h1>
            
                Building Blocks
        </h1>
        
    </section>


    <section data-state="bb1z">
        <h2>VARIABLES</h2>
        
            <img src="img-py/var-name-red.png"/>
        <br/>
            <font color="#e06666">
                <b><i>Variables</i></b></font> store <i>values</i> under a specified name
            <br/>
        
    </section>


    <section data-state="bb1"><style>.bb1 header:after { content: "VARIABLES"; }</style>
        
        <img src="img-py/vars-nametags.png"/>
       
    </section>

        <section data-state="bb1">
            <h2>Types of variables</h2>
            
                <p>Variables can store values of different <b><i>types</i></b>:</p>
              
                <p style="text-align: left;">
                    <font color="#e06666"><b>string</b></font> - a sequence of characters, comprising text
                </p>
                
                <pre><code>"a", "London", 'X', 'General Assembly'</code></pre>

                <p style="text-align: left;">
                    <font color="#e06666"><b>int</b></font> - an integer or whole number
                </p>
                
                <pre><code>1, 5, 9999, -7</code></pre>

                <p style="text-align: left;">
                    <font color="#e06666"><b>float</b></font> - a floating point number (using a decimal point)
                </p>
                
                <pre><code>3.14, 1.68, 1.0</code></pre>

                <p style="text-align: left;">
                    <font color="#e06666"><b>bool</b></font> - boolean; binary true or false values
                </p>
                
                <pre><code>true, false</code></pre>

                <p class="fragment">Note: ImageJ Macro Language variables are dynamically typedâ€”you don't need to declare the type.</p>
                
        </section>
        
        <section data-state="bb1">
        <h2>Assigning variables in ImageJ Macro</h2>
        
            <pre><code>name = "Erick";
height = 1.73; 
state = "CT";</code></pre>
        
    </section>

    <section data-state="bb1">
            <h2>Changing types</h2>
            <p>'Casting' a variable to another type requires some of the <a href="https://imagej.net/ij/developer/macro/functions.html" target="_blank">built-in functions</a> we have mentioned.</p>
            <p>
                <br/>
            </p>
            <pre><code data-line-numbers="1|2|3|4">a = parseInt("42");
b = parseFloat("1.69");
c = d2s(1.5333, 2);
print(c);
            </code></pre>
            <pre class="fragment"><code>"1.53"</code></pre>
            <br/>
        </section>


    <section data-state="bb1">
        <h2>Exercise
            
        </h2>
        <br/>
        Choose 4 things around you and create variables of 4 different types based on them
    </section>


    
    <section data-state="bb1">
        <h2>Operators</h2>
        
            <p>
                <span class="s1">You can process the values in your variables by 
                    <b>
                        <i>
                            <font color="#e06666">operators</font>
                        </i>
                    </b>:
                </span>
            </p>
            <table width="100%" cellspacing="10" cellpadding="5" border="0">
                <tbody>
                    <tr>
                        <td>
                            <font style="font-size: 30px;" color="#e06666">
                                <b>=</b>
                            </font>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Assignment: assign a value to a variable </font>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <font style="font-size: 30px;" color="#e06666">
                                <b>==</b>
                            </font>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Comparison: are two variables equal?</font>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <font style="font-size: 30px;" color="#e06666">
                                <b>!=</b>
                            </font>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Comparison: are two variables not equal?</font>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <p class="p1">
                                <span class="s1">
                                    <b>
                                        <font style="font-size: 30px;" color="#e06666">&lt;, &gt;, &lt;=, &gt;=</font>
                                    </b>
                                </span>
                            </p>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Less-than, greater-than, less or equal, greater or equal</font>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <font style="font-size: 30px;" color="#e06666">
                                <b>+, -, *, /</b>
                            </font>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Mathematical operators</font>
                        </td>
                    </tr>
                    <tr></tr>
                    <tr>
                        <td>
                            <font style="font-size: 30px;" color="#e06666">
                                <b>&&, ||</b>
                            </font>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Logical operators: and, or</font>
                        </td>
                    </tr>
                </tbody>
            </table>
            
       
    </section>


    <section data-state="bb1">
        <h2>Exercise</h2>
        
            <p>
                Create two 
                    <font color="#e06666">
                        <i>string variables</i>
                    </font>:
                
            </p>
            <p>
                
                    <i>first</i> for your first name and <i>last</i> for your last name.

            </p>

            <p>
                
                    Can you make your full name by combining <i>first</i> and <i>last</i>?
                    
            </p>
      
           
          <p>
                <font color="#e06666">

(Cheating encouraged)
</font>
            </p>
       
    </section>


    <section data-state="bb2z">
        
        
        <h2>
            
                Collections
            
        </h2>
    </section>


    <section data-state="bb2"><style>.bb2 header:after { content: "Collections"; }</style>
        <h2>Collections of Values</h2>
        
        Values can also be stored in a 
                <font color="#e06666">
                    <b>
                        <i>collection</i>
                    </b>
                </font>:
            
               <p><b>we'll only talk about the Array</b></p> 
            
         
    </section>
    
    


    
        <section data-state="bb">
            <h2>Arrays</h2>
            
                <p>
                    We can store multiple values in an <b><i><font color="#e06666">array</font>:</i></b>
                </p>
                    
                <pre><code class="java">&gt;&gt;&gt; l = newArray(1,3,9,4,884328881);
&gt;&gt;&gt; n = newArray('first', 'second', 'third', 'fourth');
&gt;&gt;&gt; m = Array.concat(l,n);
&gt;&gt;&gt; print(m[6]);
'second'</code></pre>
            
            <br/>An array is a ordered sequence of items (between [...]) each with their own index.
            <br/>
        </section>


        <section data-state="bb">
            <h2>Some array examples
                <br/>
            </h2>
            
                <pre><code class="java">
// This macro demonstrates how to use the Array.* functions.
  a1 = newArray(10, 5, 15, 2, 1.23456);
  a2 = Array.copy(a1);
  print("Array 2")
  Array.print(a2);
  a3 = Array.trim(a1, 2);
  print("Array 3");
  Array.print(a3);
  Array.sort(a1);
  print("Array 1");
  Array.print(a1);
  Array.getStatistics(a1, min, max, mean, std);
  print("stats");
  print("   min: "+min);
  print("   max: "+max);
  print("   mean: "+mean);
  print("   std dev: "+std);
  Array.fill(a1, -1);
  Array.print(a1);

// Arrays need not contain numbers!
  a1 = newArray("one", "two", "three", "four");
  print("");
  a2 = Array.copy(a1);
  Array.print(a1);
  a2 = Array.trim(a1, 2);
  Array.print(a2);
  Array.sort(a1);
  Array.print(a1);
                </code></pre>
           
            
        </section>


    <section data-menu-title="Putting the pieces together" data-state="pp">
        
        
        <h1>
                Putting the pieces together

        </h1>
        
    </section>


<section data-state="pp">
        
        
        <h1>
                Loops
        </h1>
        
    </section>


    
        <section data-state="pp">
            <h2>For Loops</h2>
            
                <p>
                    You use <i><font color="#e06666">loops</font></i> to repeat a statement.
                
                </p>
                <p>
                   A <b><i><font color="#e06666">for-loop</font></i></b> is useful when you know how many times you want to repeat an action (e.g. for every item in an array)
                
                </p>
                
                <pre><code class="C">for (start; condition; increment){
          do something
  }</code></pre>
            
            
        </section>


    <section data-state="pp">
        <h2>For Loops</h2>
        
        <p>for example:
        </p>
        <pre><code class="C">ages = newArray(18, 21, 16, 12);
for(i=0; i< lengthOf(ages); i++){
    print(ages[i]);
}
....
18
21
16
12 </code></pre>
        
    </section>


        <section data-state="pp">
            <h2>While Loops</h2>
            
                <p>A <b><i><font color="#e06666">while-loop</font></i></b> is useful when you donâ€™t know how many times you want to run, but you know when you need to stop.
                </p>
                <p>A while-loop statement checks a <i>condition</i> and loops until the condition is no longer satisfied.
                </p>
                
                
                <pre><code class="C">while (condition){
    do something;
}
   </code></pre>
                
           
        </section>


    <section data-state="pp">
        <h2>While Loops</h2>
        <p>for example:
           
        </p>
        
        <pre><code class="C">x = 2;
while(x > 0){
    print("hooray!");
    x = x - random;
}
... 
hooray!
hooray!
hooray!
hooray!
hooray!
</code></pre>
        
    </section>


    <section data-state="pp">
        
        <h2>
            Conditional Statements
        </h2>
        
    </section>


        <section data-state="pp">
            <h2>Conditional statements</h2>
            
                <p><b><i><font color="#e06666">Conditional statements</font></i></b> enable you to deal with multiple options.
                </p>
                <p>
                    A part of your code is executed based on the truth value of a condition. You perform conditional checks with: <b>if, else</b>

                </p>
                <pre><code class="python">if(condition){
    action
}
else{
    final action
}</code></pre>
                <pre><code class="C">age = 17;
if(age &lt; 18){
    print("no drinks for you");
}
... 
no drinks for you</code></pre>
                    
        </section>


    <section data-state="pp">
        
        <h2>
            Functions
        </h2>
        
    </section>


        <section data-state="pp">
            <h2>Functions</h2>
            
                <p><font color="#e06666"><b><i>Functions</i></b></font> perform a collections of tasks, bundled under a specific name
                </p>
                <p>Take input <i>argument(s)</i>, execute statement(s), return output
                </p>
                <p>
                    Input and output can be of all different types
                </p>
                
                <pre><code class="C">name = "Erick Ratamero";
length = lengthOf(name);
print(length);</code></pre>
            
            <br/>
        </section>


        <section data-state="pp">
            <h2>Built in functions</h2>
            
            <p>
                <a href="https://imagej.net/ij/developer/macro/functions.html" target="_blank">https://imagej.net/ij/developer/macro/functions.html</a>
            </p>
           
        </section>


    <section data-state="pp">
        <h2>Functions</h2>
        
            <p>You can also <i>define</i> your own functions like this:
            </p>
          
            <pre><code class="C">function function_name(argument(s)){
actions with argument(s)
return statement
    }
</code></pre>
           
            <pre><code class="C">function calculate(x, y, sigma){
    factor = exp(-1.0*(pow(x,2)+pow(y,2))/(2*pow(sigma,2)));
    return factor;
}

result = calculate(1,2,5)
print(result)
...

0.9048
</code></pre>
       

        
    </section>


     <section data-state="pp">
        
        <h2>
            
                Questions?
            
        </h2>
        
    </section>


    <section data-state="bb">
        <h2>Exercise</h2>
        
            <p>
                Create a 
                    <font color="#e06666">
                        <i>function</i>
                    </font> that takes two numbers and returns <font color="#e06666">
                        <i>"BIG!"</i>
                    </font> if they add up to at least 50, and 
                    <font color="#e06666">
                        <i>"SMALL!"</i>
                    </font> otherwise.
                
            </p>
            

            <p>
                
                    Make sure to test that it is working as intended!
                    
            </p>
      
           
          <p>
                <font color="#e06666">

(Cheating encouraged)
</font>
            </p>
       
    </section>
    


    </div>


<!-- Footer -->
<img style="position:fixed;bottom:1em;right:1em;" src="img/jax.jpg" width="20%">
<!--img style="position:fixed;bottom:1em;left:1em;" src="img/logo_tw.png" width="20%"-->
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/menu/menu.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script src="plugin/zoom/zoom.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/copycode/copycode.js"></script>

<script>
// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
    controls: true,
	controlsLayout: 'edges',
	slideNumber: true, //-- Added for development
	hashOneBasedIndex: true,
	hash: true,
	respondToHashChanges: true,
	plugins: [ RevealZoom, RevealHighlight, RevealMarkdown, RevealMenu, CopyCode ],
	menu: {
		hideMissingTitles: true,
		openSlideNumber: true,
	},
    copycode: {
        display: "icons",
        style: {
            copybg: "white",
        }
    }

});
</script>
</body>
</html>
